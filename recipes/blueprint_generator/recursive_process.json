{
  "steps": [
    {
      "type": "llm_generate",
      "config": {
        "prompt": "Convert depth {{depth}} to an integer, add 1, and return the result as a string.",
        "model": "{{model|default:'openai/gpt-4.1'}}",
        "output_format": "files",
        "content_key": "next_depth"
      }
    },
    {
      "type": "execute_recipe",
      "config": {
        "recipe_path": "analyze_components.json"
      }
    },
    {
      "type": "read_files",
      "config": {
        "path": "{{output_dir}}/analysis/component_lists.json",
        "content_key": "component_lists"
      }
    },
    {
      "type": "llm_generate",
      "config": {
        "prompt": "Check if any components need further splitting in {{component_lists}}. Output only 'true' or 'false'.",
        "model": "{{model|default:'openai/gpt-4.1'}}",
        "output_format": "files",
        "content_key": "need_further_splitting"
      }
    },
    {
      "type": "llm_generate",
      "config": {
        "prompt": "Check if we should continue recursing based on:\n1. need_further_splitting: {{need_further_splitting.files[0].content|trim}}\n2. current_depth: {{depth}}\n3. max_depth: {{max_depth|default:'3'}}\n\nOutput 'true' if need_further_splitting is 'true' AND depth < max_depth, otherwise 'false'.",
        "model": "{{model|default:'openai/gpt-4.1'}}",
        "output_format": "files",
        "output_key": "should_continue"
      }
    },
    {
      "type": "llm_generate",
      "config": {
        "prompt": "If {{should_continue.files[0].content|trim}} is 'true', output 'split_components.json', otherwise output 'stop'.",
        "model": "{{model|default:'openai/gpt-4.1'}}",
        "output_format": "files",
        "output_key": "next_action"
      }
    },
    {
      "type": "execute_recipe",
      "config": {
        "recipe_path": "{{next_action.files[0].content|trim}}",
        "optional": true
      }
    },
    {
      "type": "llm_generate",
      "config": {
        "prompt": "If {{should_continue.files[0].content|trim}} is 'true', output 'recursive_process.json', otherwise output 'stop'.",
        "model": "{{model|default:'openai/gpt-4.1'}}",
        "output_format": "files",
        "output_key": "continue_recursion"
      }
    },
    {
      "type": "execute_recipe",
      "config": {
        "recipe_path": "{{continue_recursion.files[0].content|trim}}",
        "context_overrides": {
          "depth": "{{next_depth.files[0].content|trim}}"
        },
        "optional": true
      }
    }
  ]
}
