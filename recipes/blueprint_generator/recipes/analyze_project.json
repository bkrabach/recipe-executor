{
  "steps": [
    {
      "type": "read_files",
      "config": {
        "path": "{{output_dir}}/specs/initial_project_spec.md",
        "content_key": "project_spec"
      }
    },
    {
      "type": "llm_generate",
      "config": {
        "prompt": "Analyze this project specification and determine if it should be split into multiple components.\n\nProject Specification:\n{{project_spec}}\n\nGuidance Documents:\n{{guidance_docs}}\n\nProvide your analysis as a JSON object with the following structure:\n{\n  \"needs_splitting\": true/false,\n  \"reasoning\": \"Explanation of your decision\",\n  \"recommended_components\": [\n    {\n      \"component_id\": \"component_identifier\",\n      \"component_name\": \"Human Readable Component Name\",\n      \"description\": \"Brief description of this component\"\n    }\n  ]\n}\n\nYour response should be ONLY valid JSON with no additional text.",
        "model": "{{model|default:'openai/o3-mini'}}",
        "output_format": {
          "type": "object",
          "properties": {
            "needs_splitting": { "type": "boolean" },
            "reasoning": { "type": "string" },
            "recommended_components": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "component_id": { "type": "string" },
                  "component_name": { "type": "string" },
                  "description": { "type": "string" }
                },
                "required": ["component_id", "component_name", "description"]
              }
            }
          },
          "required": ["needs_splitting", "reasoning", "recommended_components"]
        },
        "output_key": "analysis_result"
      }
    },
    {
      "type": "write_files",
      "config": {
        "files": [
          {
            "path": "analysis/analysis_result.json",
            "content_key": "analysis_result"
          }
        ],
        "root": "{{output_dir}}"
      }
    },
    {
      "type": "llm_generate",
      "config": {
        "prompt": "Based on the analysis result, determine which recipe to execute next.\n\nAnalysis Result:\n{{analysis_result}}\n\nIf needs_splitting is true, output exactly: 'split_project.json'\nIf needs_splitting is false, output exactly: 'process_single_component.json'\n\nOnly output the recipe filename and nothing else.",
        "model": "{{model|default:'openai/o3-mini'}}",
        "output_format": "text",
        "output_key": "next_recipe"
      }
    },
    {
      "type": "execute_recipe",
      "config": {
        "recipe_path": "recipes/blueprint_generator/recipes/{{next_recipe}}"
      }
    }
  ]
}
